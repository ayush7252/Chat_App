{"ast":null,"code":"import _taggedTemplateLiteral from\"C:/Users/ayush/Downloads/Chat-App/frontend/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";import _toConsumableArray from\"C:/Users/ayush/Downloads/Chat-App/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"C:/Users/ayush/Downloads/Chat-App/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/ayush/Downloads/Chat-App/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _templateObject;import _regeneratorRuntime from\"C:\\\\Users\\\\ayush\\\\Downloads\\\\Chat-App\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect,useRef}from\"react\";import styled from\"styled-components\";import ChatInput from\"./ChatInput\";import Logout from\"./Logout\";import{v4 as uuidv4}from\"uuid\";import axios from\"axios\";import{sendMessageRoute,recieveMessageRoute}from\"../utils/APIRoutes\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ChatContainer(_ref){var currentChat=_ref.currentChat,socket=_ref.socket;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var scrollRef=useRef();var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),arrivalMessage=_useState4[0],setArrivalMessage=_useState4[1];useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var data,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return JSON.parse(localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY));case 2:data=_context.sent;_context.next=5;return axios.post(recieveMessageRoute,{from:data._id,to:currentChat._id});case 5:response=_context.sent;setMessages(response.data);case 7:case\"end\":return _context.stop();}}},_callee);})),[currentChat]);useEffect(function(){var getCurrentChat=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!currentChat){_context2.next=3;break;}_context2.next=3;return JSON.parse(localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY))._id;case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function getCurrentChat(){return _ref3.apply(this,arguments);};}();getCurrentChat();},[currentChat]);var handleSendMsg=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(msg){var data,msgs;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return JSON.parse(localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY));case 2:data=_context3.sent;socket.current.emit(\"send-msg\",{to:currentChat._id,from:data._id,msg:msg});_context3.next=6;return axios.post(sendMessageRoute,{from:data._id,to:currentChat._id,message:msg});case 6:msgs=_toConsumableArray(messages);msgs.push({fromSelf:true,message:msg});setMessages(msgs);case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function handleSendMsg(_x){return _ref4.apply(this,arguments);};}();useEffect(function(){if(socket.current){socket.current.on(\"msg-recieve\",function(msg){setArrivalMessage({fromSelf:false,message:msg});});}},[]);useEffect(function(){arrivalMessage&&setMessages(function(prev){return[].concat(_toConsumableArray(prev),[arrivalMessage]);});},[arrivalMessage]);useEffect(function(){var _scrollRef$current;(_scrollRef$current=scrollRef.current)===null||_scrollRef$current===void 0?void 0:_scrollRef$current.scrollIntoView({behavior:\"smooth\"});},[messages]);return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"user-details\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"avatar\",children:/*#__PURE__*/_jsx(\"img\",{src:\"data:image/svg+xml;base64,\".concat(currentChat.avatarImage),alt:\"\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"username\",children:/*#__PURE__*/_jsx(\"h3\",{children:currentChat.username})})]}),/*#__PURE__*/_jsx(Logout,{})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-messages\",children:messages.map(function(message){return/*#__PURE__*/_jsx(\"div\",{ref:scrollRef,children:/*#__PURE__*/_jsx(\"div\",{className:\"message \".concat(message.fromSelf?\"sended\":\"recieved\"),children:/*#__PURE__*/_jsx(\"div\",{className:\"content \",children:/*#__PURE__*/_jsx(\"p\",{children:message.message})})})},uuidv4());})}),/*#__PURE__*/_jsx(ChatInput,{handleSendMsg:handleSendMsg})]});}var Container=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: grid;\\n  grid-template-rows: 10% 80% 10%;\\n  gap: 0.1rem;\\n  overflow: hidden;\\n  @media screen and (min-width: 720px) and (max-width: 1080px) {\\n    grid-template-rows: 15% 70% 15%;\\n  }\\n  .chat-header {\\n    display: flex;\\n    justify-content: space-between;\\n    align-items: center;\\n    padding: 0 2rem;\\n    .user-details {\\n      display: flex;\\n      align-items: center;\\n      gap: 1rem;\\n      .avatar {\\n        img {\\n          height: 3rem;\\n        }\\n      }\\n      .username {\\n        h3 {\\n          color: white;\\n        }\\n      }\\n    }\\n  }\\n  .chat-messages {\\n    padding: 1rem 2rem;\\n    display: flex;\\n    flex-direction: column;\\n    gap: 1rem;\\n    overflow: auto;\\n    &::-webkit-scrollbar {\\n      width: 0.2rem;\\n      &-thumb {\\n        background-color: #ffffff39;\\n        width: 0.1rem;\\n        border-radius: 1rem;\\n      }\\n    }\\n    .message {\\n      display: flex;\\n      align-items: center;\\n      .content {\\n        max-width: 40%;\\n        overflow-wrap: break-word;\\n        padding: 1rem;\\n        font-size: 1.1rem;\\n        border-radius: 1rem;\\n        color: #d1d1d1;\\n        @media screen and (min-width: 720px) and (max-width: 1080px) {\\n          max-width: 70%;\\n        }\\n      }\\n    }\\n    .sended {\\n      justify-content: flex-end;\\n      .content {\\n        background-color: #4f04ff21;\\n      }\\n    }\\n    .recieved {\\n      justify-content: flex-start;\\n      .content {\\n        background-color: #9900ff20;\\n      }\\n    }\\n  }\\n\"])));","map":{"version":3,"names":["React","useState","useEffect","useRef","styled","ChatInput","Logout","v4","uuidv4","axios","sendMessageRoute","recieveMessageRoute","jsx","_jsx","jsxs","_jsxs","ChatContainer","_ref","currentChat","socket","_useState","_useState2","_slicedToArray","messages","setMessages","scrollRef","_useState3","_useState4","arrivalMessage","setArrivalMessage","_asyncToGenerator","_regeneratorRuntime","mark","_callee","data","response","wrap","_callee$","_context","prev","next","JSON","parse","localStorage","getItem","process","env","REACT_APP_LOCALHOST_KEY","sent","post","from","_id","to","stop","getCurrentChat","_ref3","_callee2","_callee2$","_context2","apply","arguments","handleSendMsg","_ref4","_callee3","msg","msgs","_callee3$","_context3","current","emit","message","_toConsumableArray","push","fromSelf","_x","on","concat","_scrollRef$current","scrollIntoView","behavior","Container","children","className","src","avatarImage","alt","username","map","ref","div","_templateObject","_taggedTemplateLiteral"],"sources":["C:/Users/ayush/Downloads/Chat-App/frontend/src/components/ChatContainer.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport styled from \"styled-components\";\nimport ChatInput from \"./ChatInput\";\nimport Logout from \"./Logout\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport axios from \"axios\";\nimport { sendMessageRoute, recieveMessageRoute } from \"../utils/APIRoutes\";\n\nexport default function ChatContainer({ currentChat, socket }) {\n  const [messages, setMessages] = useState([]);\n  const scrollRef = useRef();\n  const [arrivalMessage, setArrivalMessage] = useState(null);\n\n  useEffect(async () => {\n    const data = await JSON.parse(\n      localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY)\n    );\n    const response = await axios.post(recieveMessageRoute, {\n      from: data._id,\n      to: currentChat._id,\n    });\n    setMessages(response.data);\n  }, [currentChat]);\n\n  useEffect(() => {\n    const getCurrentChat = async () => {\n      if (currentChat) {\n        await JSON.parse(\n          localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY)\n        )._id;\n      }\n    };\n    getCurrentChat();\n  }, [currentChat]);\n\n  const handleSendMsg = async (msg) => {\n    const data = await JSON.parse(\n      localStorage.getItem(process.env.REACT_APP_LOCALHOST_KEY)\n    );\n    socket.current.emit(\"send-msg\", {\n      to: currentChat._id,\n      from: data._id,\n      msg,\n    });\n    await axios.post(sendMessageRoute, {\n      from: data._id,\n      to: currentChat._id,\n      message: msg,\n    });\n\n    const msgs = [...messages];\n    msgs.push({ fromSelf: true, message: msg });\n    setMessages(msgs);\n  };\n\n  useEffect(() => {\n    if (socket.current) {\n      socket.current.on(\"msg-recieve\", (msg) => {\n        setArrivalMessage({ fromSelf: false, message: msg });\n      });\n    }\n  }, []);\n\n  useEffect(() => {\n    arrivalMessage && setMessages((prev) => [...prev, arrivalMessage]);\n  }, [arrivalMessage]);\n\n  useEffect(() => {\n    scrollRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  return (\n    <Container>\n      <div className=\"chat-header\">\n        <div className=\"user-details\">\n          <div className=\"avatar\">\n            <img\n              src={`data:image/svg+xml;base64,${currentChat.avatarImage}`}\n              alt=\"\"\n            />\n          </div>\n          <div className=\"username\">\n            <h3>{currentChat.username}</h3>\n          </div>\n        </div>\n        <Logout />\n      </div>\n      <div className=\"chat-messages\">\n        {messages.map((message) => {\n          return (\n            <div ref={scrollRef} key={uuidv4()}>\n              <div\n                className={`message ${\n                  message.fromSelf ? \"sended\" : \"recieved\"\n                }`}\n              >\n                <div className=\"content \">\n                  <p>{message.message}</p>\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n      <ChatInput handleSendMsg={handleSendMsg} />\n    </Container>\n  );\n}\n\nconst Container = styled.div`\n  display: grid;\n  grid-template-rows: 10% 80% 10%;\n  gap: 0.1rem;\n  overflow: hidden;\n  @media screen and (min-width: 720px) and (max-width: 1080px) {\n    grid-template-rows: 15% 70% 15%;\n  }\n  .chat-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    .user-details {\n      display: flex;\n      align-items: center;\n      gap: 1rem;\n      .avatar {\n        img {\n          height: 3rem;\n        }\n      }\n      .username {\n        h3 {\n          color: white;\n        }\n      }\n    }\n  }\n  .chat-messages {\n    padding: 1rem 2rem;\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    overflow: auto;\n    &::-webkit-scrollbar {\n      width: 0.2rem;\n      &-thumb {\n        background-color: #ffffff39;\n        width: 0.1rem;\n        border-radius: 1rem;\n      }\n    }\n    .message {\n      display: flex;\n      align-items: center;\n      .content {\n        max-width: 40%;\n        overflow-wrap: break-word;\n        padding: 1rem;\n        font-size: 1.1rem;\n        border-radius: 1rem;\n        color: #d1d1d1;\n        @media screen and (min-width: 720px) and (max-width: 1080px) {\n          max-width: 70%;\n        }\n      }\n    }\n    .sended {\n      justify-content: flex-end;\n      .content {\n        background-color: #4f04ff21;\n      }\n    }\n    .recieved {\n      justify-content: flex-start;\n      .content {\n        background-color: #9900ff20;\n      }\n    }\n  }\n`;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}